<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ice="http://www.icesoft.com/icefaces/component"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:comp="http://java.sun.com/jsf/composite/comp"
	xmlns:ace="http://www.icefaces.org/icefaces/components">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<h:body>
	<ui:composition template="/PageTemplate.xhtml">
		<ui:param name="selectedMenu" value="NDIS"></ui:param>
		<ui:define name="pageTitle"></ui:define>
		<ui:define name="PageTitleIcon">
			<img src="images/icons/home.png" />
		</ui:define>
		<ui:define name="pageHeading">NDIS Claim Manager</ui:define>
		<ui:define name="pageDescription">This allows you to view and generate NDIS claim for selected student.</ui:define>
		<ui:define name="extraHeader">
			<script type="text/javascript" src="js/pdfobject.js"></script>
		</ui:define>
		<ui:define name="pageContent">
			<ice:form id="formNdisInvoiceManager">
				<!-- 				<ice:panelGroup style="width:790px" -->
				<!-- 					rendered="#{ndisInvoiceManagerModel.internalOrganization == null}"> -->
				<!-- 					<ice:outputText value="Please add an Internal organization first." /> -->
				<!-- 					<br /> -->
				<!-- 					<ice:commandButton action="InternalOrganizationManager" -->
				<!-- 						value="Goto Internal Organizations View" style="margin-top: 20px;" /> -->
				<!-- 				</ice:panelGroup> -->
				<ice:panelPopup modal="true" styleClass="icePnlPop" draggable="true"
					autoCentre="true"
					rendered="#{ndisInvoiceManagerModel.showCreateNewInvoice}">
					<f:facet name="header">
						<ice:panelGroup styleClass="popupHeaderWrapper1"
							style="background:url(images/dialogbg1.png)">
							<ice:outputText value="Create New NDIS Invoice"
								styleClass="popupHeaderText" />
							<ice:commandButton id="closeButton"
								image="#{msgs['panelPopup.closeImage']}"
								styleClass="popupHeaderImage" title="Close" alt="Close"
								action="#{ndisInvoiceManagerModel.createNewInvoicePopup}" />
						</ice:panelGroup>
					</f:facet>
					<f:facet name="body">
						<ice:panelGroup style="width :750px;padding: 10px;">
							<ice:messages></ice:messages>
							<ice:panelGroup>
								<ice:panelGrid columns="6" width="100%">
									<ice:outputLabel value="NDIS Registration Code " />
									<ice:outputLabel value=":" />
									<ice:selectOneMenu id="selectRegistrationCode"
										partialSubmit="true"
										value="#{ndisInvoiceManagerModel.registrationCode}">
										<f:selectItems value="#{ndisInvoiceManagerModel.regCodes}"
											var="reg" itemLabel="#{reg.NDISRegistrationCode}"
											itemValue="#{reg.NDISRegistrationCode}">
										</f:selectItems>
									</ice:selectOneMenu>
									<ice:outputLabel value="Week Date " />
									<ice:outputLabel value=":" />
									<ice:selectInputDate renderMonthAsDropdown="true"
										id="inputEventToDate" renderYearAsDropdown="true"
										renderAsPopup="true"
										value="#{ndisInvoiceManagerModel.weekDate}"
										valueChangeListener="#{ndisInvoiceManagerModel.dateChange}"
										disabled="#{!empty ndisInvoiceManagerModel.selectedStudentList}"
										converter="dateConverter" partialSubmit="true">
										<f:attribute name="flag" value="date" />
									</ice:selectInputDate>
									<ice:outputLabel value="Authorizing Staff " />
									<ice:outputLabel value=":" />
									<ice:selectOneMenu id="selectAuthorizedStaff"
										partialSubmit="true"
										value="#{ndisInvoiceManagerModel.staffId}">
										<f:selectItem itemLabel="Please select" itemValue="0" />
										<f:selectItems value="#{ndisInvoiceManagerModel.staffs}"
											var="stf" itemLabel="#{stf.staffMember.contact.name}"
											itemValue="#{stf.id}">
										</f:selectItems>
									</ice:selectOneMenu>
									<ice:panelGroup>
										<ice:outputLabel value="Period " />
										<ice:outputLabel
											rendered="#{ndisInvoiceManagerModel.timePeriod == '1W'}"
											value="(1 WEEK) " />
										<ice:outputLabel
											rendered="#{ndisInvoiceManagerModel.timePeriod == '2W'}"
											value="(2 WEEK) " />
									</ice:panelGroup>
									<ice:outputLabel value=":" />
									<ice:outputLabel
										rendered="#{ndisInvoiceManagerModel.rosterTimeperiod != null}"
										value="#{ndisInvoiceManagerModel.rosterTimeperiod}" />

									<!-- 								<ice:selectOneMenu id="selectPeriod" -->
									<!-- 									value="#{ndisInvoiceManagerModel.timePeriod}" -->
									<!-- 									valueChangeListener="#{ndisInvoiceManagerModel.weekChange}" -->
									<!-- 									partialSubmit="true"> -->
									<!-- 									<f:selectItem itemLabel="1 Week" itemValue="1W" /> -->
									<!-- 									<f:selectItem itemLabel="2 Week" itemValue="2W" /> -->
									<!-- 									<f:attribute name="flag" value="period" /> -->
									<!-- 								</ice:selectOneMenu> -->

								</ice:panelGrid>
							</ice:panelGroup>
							<fieldset style="text-align: left;">
								<legend>
									<ice:outputLabel value="Available Participant(s)" />
								</legend>
								<ice:panelGrid width="100%"
									style="text-align: center;height:100px;"
									rendered="#{empty(ndisInvoiceManagerModel.studentList) and empty(ndisInvoiceManagerModel.selectedStudentList)}">
									<ice:outputText
										value="There are no student withing the selected period." />
								</ice:panelGrid>
								<ice:panelGrid columns="2"
									rendered="#{!(empty(ndisInvoiceManagerModel.studentList) and empty(ndisInvoiceManagerModel.selectedStudentList))}">
									<ice:panelGroup>
										<ice:panelGrid columns="3" cellpadding="0" cellspacing="0"
											width="100%">
											<ice:outputText value="Filter by Name" />
											<ice:inputText
												action="#{ndisInvoiceManagerModel.searchNdisStudent}"
												value="#{ndisInvoiceManagerModel.searchNdisStudentText}" />
											<ice:commandButton id="commandSearchStudent"
												style="float:right;width:80px" value="Filter"
												styleClass="CommandButton"
												action="#{ndisInvoiceManagerModel.searchNdisStudent}">
											</ice:commandButton>
										</ice:panelGrid>
										<ice:dataTable scrollable="true" scrollHeight="150px"
											value="#{ndisInvoiceManagerModel.studentList}" var="stdList"
											id="tableStudents" columnWidths="240px,60px">
											<ice:column id="columnParticipantName">
												<f:facet name="header">
													<ice:outputText value="Participant Name" />
												</f:facet>
												<ice:outputText value="#{stdList.contact.name}" />
											</ice:column>
											<ice:column style="text-align:center;">
												<f:facet name="header">
													<ice:commandLink value="Add All"
														actionListener="#{ndisInvoiceManagerModel.selectAllStudents}"
														id="commandlinkS"></ice:commandLink>
												</f:facet>
												<ice:commandLink title="Add student" id="selectStudent"
													partialSubmit="true"
													actionListener="#{ndisInvoiceManagerModel.selectStudent}">
													<ice:graphicImage style="border:none" width="13"
														height="13" url="images/icons/Add-icon.png" />
													<f:attribute name="student" value="#{stdList}" />
												</ice:commandLink>
											</ice:column>
										</ice:dataTable>
									</ice:panelGroup>
									<ice:panelGroup>
										<fieldset style="margin-left: 30px; margin-top: 18px;">
											<legend>
												<ice:outputLabel value="Selected Participant(s)" />
											</legend>
											<ice:dataTable scrollable="true" scrollHeight="150px"
												value="#{ndisInvoiceManagerModel.selectedStudentList}"
												var="stdList" id="tableStudents2" columnWidths="240px,60px">
												<ice:column id="columnParticipantName2">
													<f:facet name="header">
														<ice:outputText value="Participant Name" />
													</f:facet>
													<ice:outputText value="#{stdList.contact.name}" />
												</ice:column>
												<ice:column style="text-align:center;">
													<f:facet name="header">
														<ice:commandLink value="Remove All"
															actionListener="#{ndisInvoiceManagerModel.removeAllStudents}"
															id="commandlinkS"></ice:commandLink>
													</f:facet>
													<ice:commandLink title="Remove Student" id="selectStudent2"
														partialSubmit="true"
														actionListener="#{ndisInvoiceManagerModel.removeStudent}">
														<ice:graphicImage style="border:none" width="13"
															height="13" url="images/icons/delete-icon.png" />
														<f:attribute name="student" value="#{stdList}" />
													</ice:commandLink>
												</ice:column>
											</ice:dataTable>
										</fieldset>
									</ice:panelGroup>
								</ice:panelGrid>
							</fieldset>
							<ice:commandButton id="commandSpecialNeedToStudentSave"
								style="float :right;margin-top: 10px; margin-bottom: 10px;"
								value="Generate NDIS Claim" styleClass="CommandButton"
								disabled="#{ndisInvoiceManagerModel.internalOrganization== null}"
								action="#{ndisInvoiceManagerModel.generateNdisClaim}" />
						</ice:panelGroup>
					</f:facet>
				</ice:panelPopup>

				<!-- showEventsPopup -->
				<ice:panelPopup modal="true" styleClass="icePnlPop"
					autoCentre="true" draggable="true"
					rendered="#{ndisInvoiceManagerModel.showEvents}">
					<f:facet name="header">
						<ice:panelGroup styleClass="popupHeaderWrapper1"
							style="background:url(images/dialogbg1.png)">
							<ice:outputText value="Event List" styleClass="popupHeaderText" />
							<ice:commandButton id="closeButtonEvents"
								image="#{msgs['panelPopup.closeImage']}"
								styleClass="popupHeaderImage" title="Close" alt="Close"
								action="#{ndisInvoiceManagerModel.showEventPopup}" />
						</ice:panelGroup>
					</f:facet>
					<f:facet name="body">
						<ice:messages></ice:messages>
						<ice:panelGrid rowClasses="topAlignedTableCell">
							<ice:panelGroup>
								<fieldset style="height: 230px; float: left;">
									<legend>
										<ice:outputLabel value="NDIS Claimed Committed events" />
									</legend>
									<ice:setEventPhase events="FacesEvent"
										phase="UPDATE_MODEL_VALUES">
										<ice:dataTable scrollable="true" scrollHeight="150px"
											value="#{ndisInvoiceManagerModel.commitedEventList}"
											var="event" id="eventTable"
											columnWidths="80px,70px,70px,100px,150px,195px,195px,50px,70px,40px,70px">
											<ice:column id="column1" style="text-align : center">
												<f:facet name="header">
													<ice:outputText value="Event Date" />
												</f:facet>
												<ice:outputText value="#{event.eventDate}"
													converter="dateConverter" />
											</ice:column>
											<ice:column id="column2" style="text-align : center">
												<f:facet name="header">
													<ice:outputText value="Start Time" />
												</f:facet>
												<ice:outputText value="#{event.startTime}"
													converter="timeConverter" />
											</ice:column>
											<ice:column id="column3" style="text-align : center">
												<f:facet name="header">
													<ice:outputText value="End Time" />
												</f:facet>
												<ice:outputText value="#{event.endTime}"
													converter="timeConverter" />
											</ice:column>
											<ice:column id="column4"
												style="width:100px;text-align:center;">
												<f:facet name="header">
													<ice:outputText value="Type" />
												</f:facet>
												<ice:outputText style="width : 100px;"
													value="#{event.price.supportItem.ndisClusterType}" />
											</ice:column>
											<ice:column id="column5" style="width : 150px;">
												<f:facet name="header">
													<ice:outputText value="Program" />
												</f:facet>
												<ice:outputText style="width : 150px;word-wrap: break-word;"
													value="#{event.studentGroup.name}" />
											</ice:column>
											<ice:column id="column6" style="width : 195px;">
												<f:facet name="header">
													<ice:outputText value="Support Cluster" />
												</f:facet>
												<ice:outputText style="width : 195px;word-wrap: break-word"
													value="#{event.price.supportItem.itemName}" />
											</ice:column>
											<ice:column id="column7" style="width : 195px;">
												<f:facet name="header">
													<ice:outputText value="Price Name" />
												</f:facet>
												<ice:outputText style="width : 195px;word-wrap: break-word"
													value="#{event.price.priceName}" />
											</ice:column>
											<ice:column id="column8">
												<f:facet name="header">
													<ice:outputText value="UOM" />
												</f:facet>
												<ice:outputText
													style="word-wrap: break-word;text-align : center;"
													value="#{event.price.uom}" />
											</ice:column>
											<ice:column id="column9" style="text-align : right">
												<f:facet name="header">
													<ice:outputText value="Price" />
												</f:facet>
												<ice:outputText value="#{event.price.price}">
													<f:convertNumber maxFractionDigits="2"
														minFractionDigits="2" />
												</ice:outputText>
											</ice:column>
											<ice:column id="column10" style="text-align : right">
												<f:facet name="header">
													<ice:outputText value="Units"
														title="Hours/Number of units/KMs per Day" />
												</f:facet>
												<ice:outputText value="#{event.units}"
													title="#{event.unitsType}" />
											</ice:column>
											<ice:column id="column11" style="text-align : right">
												<f:facet name="header">
													<ice:outputText value="Event Price" />
												</f:facet>
												<ice:outputText value="#{event.eventPrice}">
													<f:convertNumber maxFractionDigits="2"
														minFractionDigits="2" />
												</ice:outputText>
											</ice:column>
										</ice:dataTable>
									</ice:setEventPhase>
								</fieldset>
							</ice:panelGroup>
						</ice:panelGrid>
					</f:facet>
				</ice:panelPopup>

				<!-- main view -->
				<ice:panelGroup>
					<ice:panelGrid styleClass="borderBox" width="100%">
						<ice:panelGrid columns="8">
							<ice:outputText value="Filter By Date Range"
								style="width:135px;margin-right : 30px;" />
							<ice:outputText value="Start Date:" />
							<ice:selectInputDate renderMonthAsDropdown="true"
								style="margin-right:30px;" id="inputDateStart"
								renderYearAsDropdown="true" renderAsPopup="true"
								converter="dateConverter"
								value="#{ndisInvoiceManagerModel.filterStartDate}"
								partialSubmit="true" label="Date">
								<f:attribute name="flag" value="date" />
							</ice:selectInputDate>
							<ice:outputText value="End Date:" />
							<ice:selectInputDate renderMonthAsDropdown="true"
								id="inputDateEnd" renderYearAsDropdown="true"
								renderAsPopup="true" converter="dateConverter"
								value="#{ndisInvoiceManagerModel.filterEndDate}"
								partialSubmit="true" label="Date">
								<f:attribute name="flag" value="date" />
							</ice:selectInputDate>

							<ice:commandButton id="commandStaffAdd" value="Filter"
								styleClass="CommandButton"
								style="margin-left : 20px;width : 60px;"
								action="#{ndisInvoiceManagerModel.filterInvoice}">
							</ice:commandButton>
							<ice:commandButton
								action="#{ndisInvoiceManagerModel.createNewInvoice}"
								styleClass="CommandButton" value="Create New Invoice"
								style="margin-left: 5px;width : 140px;" />
						</ice:panelGrid>
					</ice:panelGrid>
				</ice:panelGroup>
				<ice:dataTable scrollable="true" scrollHeight="150px"
					value="#{ndisInvoiceManagerModel.invoiceList}" var="invo"
					id="tableinvoice"
					columnWidths="100px,160px,150px,150px,150px,300px">
					<ice:column id="columnInvoiceId" style="text-align:right">
						<ice:setEventPhase phase="INVOKE_APPLICATION" events="FacesEvent">
							<ice:rowSelector id="rowselectInvoice"
								clickListener="#{ndisInvoiceManagerModel.selectInvoice}"
								value="#{invo.ui_selected}">
								<f:attribute name="invo" value="#{invo}" />
							</ice:rowSelector>
						</ice:setEventPhase>
						<f:facet name="header">
							<ice:outputText value="Invoice Id" />
						</f:facet>
						<ice:outputText value="#{invo.id}" />
					</ice:column>
					<ice:column id="columnInvoiceRegistrationCode"
						style="text-align:center">
						<f:facet name="header">
							<ice:outputText value="Registration Code" />
						</f:facet>
						<ice:outputText value="#{invo.registrationCode}" />
					</ice:column>
					<ice:column id="columnInvoiceGeneratedDate"
						style="text-align:center">
						<f:facet name="header">
							<ice:outputText value="Generated Date" />
						</f:facet>
						<ice:outputText value="#{invo.generateDate}"
							converter="dateConverter" />
					</ice:column>
					<ice:column id="columnInvoiceFromDate" style="text-align:center">
						<f:facet name="header">
							<ice:outputText value="From Date" />
						</f:facet>
						<ice:outputText value="#{invo.startDay}" converter="dateConverter" />
					</ice:column>
					<ice:column id="columnInvoiceToDate" style="text-align:center">
						<f:facet name="header">
							<ice:outputText value="To Date" />
						</f:facet>
						<ice:outputText value="#{invo.endDay}" converter="dateConverter" />
					</ice:column>
					<ice:column id="columnInvoiceAuthStaff">
						<f:facet name="header">
							<ice:outputText value="Authorised Staff Member" />
						</f:facet>
						<ice:outputText
							value="#{invo.authorisedstaff.staffMember.contact.name}" />
					</ice:column>
				</ice:dataTable>
				<ice:panelTabSet title="Details">
					<ice:panelTab title="Details" label="Ndis Invoice Details">
						<ice:panelGroup style="margin-top: 20px;height:300px;"
							rendered="#{ndisInvoiceManagerModel.generetedDate == null}">
							<ice:outputText value="Please select an Invoice to view details." />
						</ice:panelGroup>
						<ice:panelGrid columns="2" rowClasses="topAlignedTableCell"
							rendered="#{ndisInvoiceManagerModel.generetedDate != null}">
							<ice:panelGroup>
								<fieldset style="width: 400px;">
									<legend>
										<ice:outputLabel value="Selected Invoice Details" />
									</legend>
									<ice:panelGrid columns="2" width="100%" cellpadding="5">
										<ice:outputText value="Invoice Id" />
										<ice:panelGrid
											style="width: 205px; border: 1px solid grey; float: right;">
											<ice:outputText value="#{ndisInvoiceManagerModel.invoiceId}" />
										</ice:panelGrid>
										<ice:outputText value="Genereted Date" />
										<ice:panelGrid
											style="width: 205px; border: 1px solid grey; float: right;">
											<ice:outputText
												value="#{ndisInvoiceManagerModel.generetedDate}" />
										</ice:panelGrid>
										<ice:outputText value="Date Range" />
										<ice:panelGrid
											style="width: 205px; border: 1px solid grey; float: right;">
											<ice:outputText value="#{ndisInvoiceManagerModel.dateRange}" />
										</ice:panelGrid>
										<ice:outputText value="Authorized Staff" />
										<ice:panelGrid
											style="width: 205px; border: 1px solid grey; float: right;">
											<ice:outputText
												value="#{ndisInvoiceManagerModel.authorizedStaffName}" />
										</ice:panelGrid>
										<ice:outputText value="Number of Students" />
										<ice:panelGrid
											style="width: 205px; border: 1px solid grey; float: right;">
											<ice:outputText
												value="#{ndisInvoiceManagerModel.numberOfStudent}" />
										</ice:panelGrid>
										<br />
										<ice:panelGroup style="float:right">
											<ice:commandButton id="commandDownloadcsv"
												value="Download CSV" styleClass="CommandButton"
												style="width:100px; margin-right: 5px;"
												disabled="#{ndisInvoiceManagerModel.generetedDate == null}"
												action="#{ndisInvoiceManagerModel.downloadCvs}">
												<f:ajax disabled="true" />
											</ice:commandButton>
											<ice:commandButton id="commandDeleteinvoce"
												value="Delete Invoice" styleClass="CommandButton"
												disabled="#{ndisInvoiceManagerModel.generetedDate == null}"
												style="width:100px"
												panelConfirmation="deleteNdisInvoiceConfirmation"
												action="#{ndisInvoiceManagerModel.deleteInvoice}" />
										</ice:panelGroup>
									</ice:panelGrid>
									<ice:panelConfirmation id="deleteNdisInvoiceConfirmation"
										acceptLabel="Yes" cancelLabel="No" draggable="true"
										title="Confirm"
										message="Are you sure you want to perform this action?" />
								</fieldset>
							</ice:panelGroup>
							<ice:panelGroup>
								<fieldset
									style="width: 590px; margin-right: -20px; min-height: 225px">
									<legend>
										<ice:outputLabel
											value="Participant list of the selected invoice " />
									</legend>
									<ice:dataTable columnWidths="30px,160px,150px,50px,80px,50px"
										value="#{ndisInvoiceManagerModel.slectedInvoiceStudentList}"
										var="student">
										<ice:column id="columnInvoiceStudentid"
											style="text-align:right">
											<f:facet name="header">
												<ice:outputText value="Id" />
											</f:facet>
											<ice:outputText value="#{student.id}" />
										</ice:column>
										<ice:column id="columnInvoiceStudentName"
											style="text-align:left">
											<f:facet name="header">
												<ice:outputText value="Student Name" />
											</f:facet>
											<ice:outputText value="#{student.contact.name}" />
										</ice:column>
										<ice:column id="columnInvoiceStudentsneed"
											style="text-align:left">
											<f:facet name="header">
												<ice:outputText value="Special need" />
											</f:facet>
											<ui:repeat value="#{student.specialNeeds}" var="sneed"
												varStatus="status">
												<ice:outputText value="#{sneed.name}" style="float:left"
													title="#{sneed.name}" rendered="#{sneed.icon == null}">
													<f:converter converterId="truncateConverter" />
												</ice:outputText>
												<ice:outputText value=",&nbsp;" style="float:left"
													rendered="#{sneed.icon == null and student.specialNeeds.size() > 1 and status.index != student.specialNeeds.size() - 1}" />
											</ui:repeat>
										</ice:column>
										<ice:column id="columnInvoiceStudentgender"
											style="text-align:center">
											<f:facet name="header">
												<ice:outputText value="Gender" />
											</f:facet>
											<ice:outputText value="#{student.gender}" />
										</ice:column>
										<ice:column id="columnInvoiceStudentdob"
											style="text-align:center">
											<f:facet name="header">
												<ice:outputText value="Date of Birth" />
											</f:facet>
											<ice:outputText value="#{student.dob}"
												converter="dateConverter" />
										</ice:column>
										<ice:column style="text-align:center">
											<f:facet name="header">
												<ice:outputText value="View Events" />
											</f:facet>
											<ice:commandLink value="View"
												actionListener="#{ndisInvoiceManagerModel.openEvents}"
												id="commandlinkS">
												<f:attribute name="student" value="#{student}" />
											</ice:commandLink>
										</ice:column>
									</ice:dataTable>
								</fieldset>
							</ice:panelGroup>
						</ice:panelGrid>
					</ice:panelTab>
				</ice:panelTabSet>
			</ice:form>
		</ui:define>
	</ui:composition>
</h:body>
</head>
</html>